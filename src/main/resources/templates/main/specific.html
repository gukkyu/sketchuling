<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/specificLayout}">
<th:block layout:fragment="content">
  <section class="contents h-100 ">

    <div class="w-100 h-90 my-3">
      <div id="todolistBox" class="w-90 px-3">
        <div id="todoListWeek" class="font-weight-bold my-3 p-3 category">ì£¼ê°„ í•  ì¼ ëª©ë¡</div>
        <div class="my-2">
          <div class="d-flex align-items-center category p-2">
            <div class="category-color mr-3"></div>
            <div>ì¼</div>
          </div>
          <div>
            <div class="d-flex my-3 py-3 bg-white subcategory">
              <div class="subcategory-color mr-3 mt-2"></div>
              <div>
                <div class="mb-4 mt-1">A í”„ë¡œì íŠ¸</div>
                <div class="todolist">
                  <div class="my-3">AAAí•˜ê¸°</div>
                  <div class="my-3">AAAí•˜ê¸°</div>
                  <div class="my-3">AAAí•˜ê¸°</div>
                </div>
              </div>
            </div>
            <div class="d-flex my-3 py-3 subcategory">
              <div class="subcategory-color mr-3 mt-2"></div>
              <div>
                <div class="mb-4 mt-1">A í”„ë¡œì íŠ¸</div>
                <div>
                  <div class="todo my-3">í•˜ê¸°í•˜ê¸°í•˜ê¸°í•˜ê¸°í•˜ê¸°</div>
                  <div class="my-3">AAAí•˜ê¸°</div>
                  <div class="my-3">AAAí•˜ê¸°</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="my-2">
          <div class="d-flex align-items-center category p-2">
            <div class="category-color mr-3"></div>
            <div>ì¼</div>
          </div>
          <div class="todolist my-3 py-3 subcategory">
            <div class="my-3">AAAí•˜ê¸°</div>
            <div class="my-3">AAAí•˜ê¸°</div>
          </div>
          <div class="d-flex my-3 py-3 subcategory">
            <div class="subcategory-color mr-3 mt-2"></div>
            <div>
              <div class="mb-4 mt-1">A í”„ë¡œì íŠ¸</div>
              <div class="todolist">
                <div class="my-3">AAAí•˜ê¸°</div>
                <div class="my-3">AAAí•˜ê¸°</div>
                <div class="my-3">AAAí•˜ê¸°</div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div id="addBtn" class="d-flex justify-content-center align-items-center">ì¼ì • ì¶”ê°€</div>
  </section>
  <script>
    function updateCalendarHref(newDate) {
      let calendarBox = document.getElementById("calenderBox");
      if (calendarBox) {
        calendarBox.setAttribute("href", `/main?date=${newDate}`);
      }
    }

    function updateWeekDates() {
      let formattedDate = selectedDate.toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹ ë³€í™˜

      $.ajax({
        url: "/main/updateDates",
        type: "POST",
        data: { "date": formattedDate },
        success: function(data) {
          console.log("Updated week data:", data);

          let dayKeys = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

          dayKeys.forEach(day => {
            let element = document.querySelector(`.${day.toLowerCase()} .date-value`);
            let linkElement = document.querySelector(`.${day.toLowerCase()}`); // í•´ë‹¹ ìš”ì¼ì˜ <a> íƒœê·¸

            if (element && data[day]) {
              let rawDate = data[day]; // ì„œë²„ì—ì„œ ë°›ì€ YYYY-MM-DD í˜•ì‹
              element.setAttribute("data-raw-date", rawDate); // ì›ë³¸ ë‚ ì§œ ì €ì¥

              let parts = rawDate.split("-"); // ["2024", "02", "12"]
              let formattedDate = parts[1] + "/" + parts[2]; // "02/12"
              element.textContent = formattedDate; // í™”ë©´ì— MM/dd í˜•ì‹ìœ¼ë¡œ í‘œì‹œ

              // ğŸ“Œ ê° ìš”ì¼ì˜ <a> íƒœê·¸ href ì—…ë°ì´íŠ¸
              if (linkElement) {
                linkElement.setAttribute("href", `/main/specific?date=${rawDate}`);
              }
            }
          });

          // ğŸ“Œ ì£¼ê°„ ìº˜ë¦°ë” ë§í¬ ì—…ë°ì´íŠ¸ â†’ ì£¼ì˜ ì‹œì‘ì¼(ì›”ìš”ì¼) ê¸°ì¤€
          if (data["Monday"]) {
            updateCalendarHref(data["Monday"]);
          }
        },
        error: function(xhr, status, error) {
          console.error("Error fetching week dates:", error);
        }
      });
    }

    // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì‹¤í–‰
    document.addEventListener("DOMContentLoaded", function() {
      updateWeekDates();
    });
  </script>
</th:block>