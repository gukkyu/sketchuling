<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/specificLayout}">
<th:block layout:fragment="content">
  <section class="contents h-100 ">

    <div class="w-100 h-90 my-3">
      <div id="todolistBox" class="w-90 px-3">
        <div id="todoListWeek" class="font-weight-bold my-3 p-3 category">주간 할 일 목록</div>
        <div class="my-2">
          <div class="d-flex align-items-center category p-2">
            <div class="category-color mr-3"></div>
            <div>일</div>
          </div>
          <div>
            <div class="d-flex my-3 py-3 bg-white subcategory">
              <div class="subcategory-color mr-3 mt-2"></div>
              <div>
                <div class="mb-4 mt-1">A 프로젝트</div>
                <div class="todolist">
                  <div class="my-3">AAA하기</div>
                  <div class="my-3">AAA하기</div>
                  <div class="my-3">AAA하기</div>
                </div>
              </div>
            </div>
            <div class="d-flex my-3 py-3 subcategory">
              <div class="subcategory-color mr-3 mt-2"></div>
              <div>
                <div class="mb-4 mt-1">A 프로젝트</div>
                <div>
                  <div class="todo my-3">하기하기하기하기하기</div>
                  <div class="my-3">AAA하기</div>
                  <div class="my-3">AAA하기</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="my-2">
          <div class="d-flex align-items-center category p-2">
            <div class="category-color mr-3"></div>
            <div>일</div>
          </div>
          <div class="todolist my-3 py-3 subcategory">
            <div class="my-3">AAA하기</div>
            <div class="my-3">AAA하기</div>
          </div>
          <div class="d-flex my-3 py-3 subcategory">
            <div class="subcategory-color mr-3 mt-2"></div>
            <div>
              <div class="mb-4 mt-1">A 프로젝트</div>
              <div class="todolist">
                <div class="my-3">AAA하기</div>
                <div class="my-3">AAA하기</div>
                <div class="my-3">AAA하기</div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div id="addBtn" class="d-flex justify-content-center align-items-center">일정 추가</div>
  </section>
  <script>
    function updateCalendarHref(newDate) {
      let calendarBox = document.getElementById("calenderBox");
      if (calendarBox) {
        calendarBox.setAttribute("href", `/main?date=${newDate}`);
      }
    }

    function updateWeekDates() {
      let formattedDate = selectedDate.toISOString().split('T')[0]; // YYYY-MM-DD 형식 변환

      $.ajax({
        url: "/main/updateDates",
        type: "POST",
        data: { "date": formattedDate },
        success: function(data) {
          console.log("Updated week data:", data);

          let dayKeys = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

          dayKeys.forEach(day => {
            let element = document.querySelector(`.${day.toLowerCase()} .date-value`);
            let linkElement = document.querySelector(`.${day.toLowerCase()}`); // 해당 요일의 <a> 태그

            if (element && data[day]) {
              let rawDate = data[day]; // 서버에서 받은 YYYY-MM-DD 형식
              element.setAttribute("data-raw-date", rawDate); // 원본 날짜 저장

              let parts = rawDate.split("-"); // ["2024", "02", "12"]
              let formattedDate = parts[1] + "/" + parts[2]; // "02/12"
              element.textContent = formattedDate; // 화면에 MM/dd 형식으로 표시

              // 📌 각 요일의 <a> 태그 href 업데이트
              if (linkElement) {
                linkElement.setAttribute("href", `/main/specific?date=${rawDate}`);
              }
            }
          });

          // 📌 주간 캘린더 링크 업데이트 → 주의 시작일(월요일) 기준
          if (data["Monday"]) {
            updateCalendarHref(data["Monday"]);
          }
        },
        error: function(xhr, status, error) {
          console.error("Error fetching week dates:", error);
        }
      });
    }

    // ✅ 페이지 로드 시 초기 실행
    document.addEventListener("DOMContentLoaded", function() {
      updateWeekDates();
    });
  </script>
</th:block>